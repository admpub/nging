(function(p){"use strict";var o=function(t,i){var e=this;this.options=i;this.$tableWrapper=null;this.$tableScrollWrapper=p(t);this.$table=p(t).find("table");if(this.$table.length!==1){throw new Error("Exactly one table is expected in a .table-responsive div.")}this.$tableScrollWrapper.attr("data-pattern",this.options.pattern);this.id=this.$table.prop("id")||this.$tableScrollWrapper.prop("id")||"id"+Math.random().toString(16).slice(2);this.$tableClone=null;this.$stickyTableHeader=null;this.$thead=this.$table.find("thead");this.$hdrCells=this.$thead.find("tr").first().find("th");this.$bodyRows=this.$table.find("tbody, tfoot").find("tr");this.$btnToolbar=null;this.$dropdownGroup=null;this.$dropdownBtn=null;this.$dropdownContainer=null;this.$displayAllBtn=null;this.$focusGroup=null;this.$focusBtn=null;this.displayAllTrigger="display-all-"+this.id+".responsive-table";this.idPrefix=this.id+"-col-";this.headerColIndices={};this.headerRowIndices={};this.wrapTable();this.createButtonToolbar();this.buildHeaderCellIndices();this.setupTableHeader();this.setupBodyRows();if(this.options.stickyTableHeader){this.createStickyTableHeader()}if(this.$dropdownContainer.is(":empty")){this.$dropdownGroup.hide()}p(window).bind("orientationchange resize "+this.displayAllTrigger,function(){e.$dropdownContainer.find("input").trigger("updateCheck");p.proxy(e.updateSpanningCells(),e)}).trigger("resize")};o.DEFAULTS={pattern:"priority-columns",stickyTableHeader:true,fixedNavbar:".navbar-fixed-top",addDisplayAllBtn:true,addFocusBtn:true,focusBtnIcon:"glyphicon glyphicon-screenshot",mainContainer:window,i18n:{focus:"Focus",display:"Display",displayAll:"Display all"}};o.prototype.wrapTable=function(){this.$tableScrollWrapper.wrap('<div class="table-wrapper"/>');this.$tableWrapper=this.$tableScrollWrapper.parent()};o.prototype.createButtonToolbar=function(){var t=this;this.$btnToolbar=p('[data-responsive-table-toolbar="'+this.id+'"]').addClass("btn-toolbar");if(this.$btnToolbar.length===0){this.$btnToolbar=p('<div class="btn-toolbar" />')}this.$dropdownGroup=p('<div class="btn-group dropdown-btn-group pull-right" />');this.$dropdownBtn=p('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">'+this.options.i18n.display+' <span class="caret"></span></button>');this.$dropdownContainer=p('<ul class="dropdown-menu"/>');if(this.options.addFocusBtn){this.$focusGroup=p('<div class="btn-group focus-btn-group" />');this.$focusBtn=p('<button type="button" class="btn btn-default">'+this.options.i18n.focus+"</button>");if(this.options.focusBtnIcon){this.$focusBtn.prepend('<span class="'+this.options.focusBtnIcon+'"></span> ')}this.$focusGroup.append(this.$focusBtn);this.$btnToolbar.append(this.$focusGroup);this.$focusBtn.click(function(){p.proxy(t.activateFocus(),t)});this.$bodyRows.click(function(){p.proxy(t.focusOnRow(p(this)),t)})}if(this.options.addDisplayAllBtn){this.$displayAllBtn=p('<button type="button" class="btn btn-default">'+this.options.i18n.displayAll+"</button>");this.$dropdownGroup.append(this.$displayAllBtn);if(this.$table.hasClass("display-all")){this.$displayAllBtn.addClass("btn-primary")}this.$displayAllBtn.click(function(){p.proxy(t.displayAll(null,true),t)})}this.$dropdownGroup.append(this.$dropdownBtn).append(this.$dropdownContainer);this.$btnToolbar.append(this.$dropdownGroup);this.$tableScrollWrapper.before(this.$btnToolbar)};o.prototype.clearAllFocus=function(){this.$bodyRows.removeClass("unfocused");this.$bodyRows.removeClass("focused")};o.prototype.activateFocus=function(){this.clearAllFocus();if(this.$focusBtn){this.$focusBtn.toggleClass("btn-primary")}this.$table.toggleClass("focus-on")};o.prototype.focusOnRow=function(t){if(this.$table.hasClass("focus-on")){var i=p(t).hasClass("focused");this.clearAllFocus();if(!i){this.$bodyRows.addClass("unfocused");p(t).addClass("focused")}}};o.prototype.displayAll=function(t,i){if(this.$displayAllBtn){this.$displayAllBtn.toggleClass("btn-primary",t)}this.$table.toggleClass("display-all",t);if(this.$tableClone){this.$tableClone.toggleClass("display-all",t)}if(i){p(window).trigger(this.displayAllTrigger)}};o.prototype.preserveDisplayAll=function(){var t="table-cell";if(p("html").hasClass("lt-ie9")){t="inline"}p(this.$table).find("th, td").css("display",t);if(this.$tableClone){p(this.$tableClone).find("th, td").css("display",t)}};o.prototype.createStickyTableHeader=function(){var i=this;i.$tableClone=i.$table.clone();i.$tableClone.prop("id",this.id+"-clone");i.$tableClone.find("[id]").each(function(){p(this).prop("id",p(this).prop("id")+"-clone")});i.$tableClone.wrap('<div class="sticky-table-header"/>');i.$stickyTableHeader=i.$tableClone.parent();i.$stickyTableHeader.css("height",i.$thead.height()+2);i.$table.before(i.$stickyTableHeader);p(this.options.mainContainer).bind("scroll",function(){p.proxy(i.updateStickyTableHeader(),i)});p(window).bind("resize",function(t){p.proxy(i.updateStickyTableHeader(),i)});p(i.$tableScrollWrapper).bind("scroll",function(){p.proxy(i.updateStickyTableHeader(),i)});i.useFixedSolution=!a()||s()>=8;if(i.useFixedSolution){i.$tableScrollWrapper.addClass("fixed-solution")}else{i.$tableScrollWrapper.addClass("absolute-solution")}};o.prototype.updateStickyTableHeader=function(){var t=this,i=0,e=t.$table.offset().top,a=p(this.options.mainContainer).scrollTop()-1,o=t.$table.height()-t.$stickyTableHeader.height(),s=a+p(this.options.mainContainer).height()-p(document).height(),n=0;if(p(t.options.fixedNavbar).length){var l=p(t.options.fixedNavbar).first();n=l.css("position")==="fixed"?l.outerHeight():0;a=a+n}var r;if(this.options.mainContainer===window){r=a>e&&a<e+t.$table.height()}else{r=e<=0&&-e<t.$table.height()}if(t.useFixedSolution){t.$stickyTableHeader.scrollLeft(t.$tableScrollWrapper.scrollLeft());i=n-1;if(this.options.mainContainer===window&&a-e>o){i-=a-e-o;t.$stickyTableHeader.addClass("border-radius-fix")}else if(this.options.mainContainer!==window&&-e>o){i-=-e-o;t.$stickyTableHeader.addClass("border-radius-fix")}else{t.$stickyTableHeader.removeClass("border-radius-fix")}if(r){t.$stickyTableHeader.css({visibility:"visible",top:i+"px",width:t.$tableScrollWrapper.innerWidth()+"px"});return}else{t.$stickyTableHeader.css({visibility:"hidden",width:"auto"})}}else{var d=400;if(this.options.mainContainer===window){i=a-e-1}else{i=-e-1}if(i<0){i=0}else if(i>o){i=o}if(this.options.mainContainer===window){if(s>0){i=i-s}}if(r){t.$stickyTableHeader.css({visibility:"visible"});t.$stickyTableHeader.animate({top:i+"px"},d);t.$thead.css({visibility:"hidden"})}else{t.$stickyTableHeader.animate({top:"0"},d,function(){t.$thead.css({visibility:"visible"});t.$stickyTableHeader.css({visibility:"hidden"})})}}};o.prototype.setupTableHeader=function(){var n=this;n.$hdrCells.each(function(t){var i=p(this),e=i.prop("id"),a=i.text();if(!e){e=n.idPrefix+t;i.prop("id",e)}if(a===""){a=i.attr("data-col-name")}if(i.is("[data-priority]")&&i.data("priority")!==-1){var o=p('<li class="checkbox-row"><input type="checkbox" name="toggle-'+e+'" id="toggle-'+e+'" value="'+e+'" /> <label for="toggle-'+e+'">'+a+"</label></li>");var s=o.find("input");n.$dropdownContainer.append(o);o.click(function(){s.prop("checked",!s.prop("checked"));s.trigger("change")});if(p("html").hasClass("lt-ie9")){s.click(function(){p(this).trigger("change")})}o.find("label").click(function(t){t.stopPropagation()});o.find("input").click(function(t){t.stopPropagation()}).change(function(){var e=p(this),t=e.val(),i=n.$tableWrapper.find("#"+t+", #"+t+"-clone, [data-columns~="+t+"]");if(n.$table.hasClass("display-all")){p.proxy(n.preserveDisplayAll(),n);n.$table.removeClass("display-all");if(n.$tableClone){n.$tableClone.removeClass("display-all")}n.$displayAllBtn.removeClass("btn-primary")}i.each(function(){var t=p(this);if(e.is(":checked")){if(!t.closest("thead").length&&t.css("display")!=="none"){var i=Math.min(parseInt(t.prop("colSpan"))+1,t.attr("data-org-colspan"));t.prop("colSpan",i)}t.show()}else{if(!t.closest("thead").length&&parseInt(t.prop("colSpan"))>1){t.prop("colSpan",parseInt(t.prop("colSpan"))-1)}else{t.hide()}}})}).bind("updateCheck",function(){if(i.css("display")!=="none"){p(this).prop("checked",true)}else{p(this).prop("checked",false)}})}});if(!p.isEmptyObject(this.headerRowIndices)){n.setupRow(this.$thead.find("tr:eq(1)"),this.headerRowIndices)}};o.prototype.setupBodyRows=function(){var t=this;t.$bodyRows.each(function(){t.setupRow(p(this),t.headerColIndices)})};o.prototype.setupRow=function(t,n){var l=this;if(t.data("setup")){return}else{t.data("setup",true)}var r=0;t.find("th, td").each(function(){var t=p(this);var i="";var e=t.prop("colSpan");t.attr("data-org-colspan",e);if(e>1){t.addClass("spn-cell")}for(var a=r;a<r+e;a++){i=i+" "+l.idPrefix+n[a];var o=l.$table.find("#"+l.idPrefix+n[a]);var s=o.attr("data-priority");if(s){t.attr("data-priority",s)}}i=i.substring(1);t.attr("data-columns",i);r=r+e})};o.prototype.buildHeaderCellIndices=function(){var s=this;var n={};this.headerColIndices={};this.headerRowIndices={};var l=0;var r=0;this.$thead.find("tr").first().find("th").each(function(t){var i=p(this);var e=i.prop("colSpan");var a=i.prop("rowSpan");for(var o=0;o<e;o++){s.headerColIndices[l+t+o]=t;if(l+t+o>=0){n[l+t+o-r]=r}}if(a>1){r++}l+=e-1});if(this.$thead.find("tr").length>2){throw new Error("This plugin doesnt support more than two rows in thead.")}if(this.$thead.find("tr").length===2){var t=p(this.$thead.find("tr")[1]);t.find("th").each(function(t){s.headerRowIndices[t]=s.headerColIndices[n[t]+t]})}};o.prototype.update=function(){this.$bodyRows=this.$table.find("tbody, tfoot").find("tr");this.setupBodyRows();this.$tableClone.find("tbody, tfoot").remove();var t=this.$table.find("tbody, tfoot").clone();t.find("[id]").each(function(){p(this).prop("id",p(this).prop("id")+"-clone")});t.appendTo(this.$tableClone);this.$dropdownContainer.find("input").trigger("change")};o.prototype.updateSpanningCells=function(){var t=this;t.$table.find(".spn-cell").each(function(){var t=p(this);var i=t.attr("data-columns").split(" ");var e=i.length;var a=0;for(var o=0;o<e;o++){if(p("#"+i[o]).css("display")==="none"){a++}}if(a!==e){t.show()}else{t.hide()}t.prop("colSpan",Math.max(e-a,1))})};var t=p.fn.responsiveTable;p.fn.responsiveTable=function(a){return this.each(function(){var t=p(this);var i=t.data("responsiveTable");var e=p.extend({},o.DEFAULTS,t.data(),typeof a==="object"&&a);if(e.pattern===""){return}if(!i){t.data("responsiveTable",i=new o(this,e))}if(typeof a==="string"){i[a]()}})};p.fn.responsiveTable.Constructor=o;p.fn.responsiveTable.noConflict=function(){p.fn.responsiveTable=t;return this};p(document).on("ready.responsive-table.data-api",function(){p(".table-responsive[data-pattern]").each(function(){var t=p(this);t.responsiveTable(t.data())})});p(document).on("click.dropdown.data-api",".dropdown-menu .checkbox-row",function(t){t.stopPropagation()});function i(){return typeof window.matchMedia!=="undefined"||typeof window.msMatchMedia!=="undefined"||typeof window.styleMedia!=="undefined"}function e(){return"ontouchstart"in window}function a(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))}function s(){if(a()){var t=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""));return t}else{return 0}}p(document).ready(function(){p("html").removeClass("no-js").addClass("js");if(i()){p("html").addClass("mq")}else{p("html").addClass("no-mq")}if(e()){p("html").addClass("touch")}else{p("html").addClass("no-touch")}})})(jQuery);