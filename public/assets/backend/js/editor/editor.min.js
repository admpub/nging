App.loader.libs.editormdPreview=["#editor/markdown/lib/marked.min.js","#editor/markdown/lib/prettify.min.js","#editor/markdown/lib/raphael.min.js","#editor/markdown/lib/underscore.min.js","#editor/markdown/css/editormd.preview.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.editormd=["#editor/markdown/css/editormd.min.css","#editor/markdown/css/editormd.preview.min.css","#editor/markdown/editormd.min.js"];App.loader.libs.flowChart=["#editor/markdown/lib/flowchart.min.js","#editor/markdown/lib/jquery.flowchart.min.js"];App.loader.libs.sequenceDiagram=["#editor/markdown/lib/sequence-diagram.min.js"];App.loader.libs.xheditor=["#editor/xheditor/xheditor.min.js","#editor/xheditor/xheditor_lang/"+App.lang+".js"];App.loader.libs.ueditor=["#editor/ueditor/ueditor.config.js","#editor/ueditor/ueditor.all.min.js"];App.loader.libs.tinymce=["#editor/tinymce/tinymce.min.js","#editor/tinymce/jquery.tinymce.min.js","#editor/tinymce/langs/"+App.langTag("_")+".js"];App.loader.libs.dialog=["#dialog/bootstrap-dialog.min.css","#dialog/bootstrap-dialog.min.js"];App.loader.libs.markdownit=["#markdown/it/markdown-it.min.js","#markdown/it/plugins/emoji/markdown-it-emoji.min.js"];App.loader.libs.codehighlight=["#markdown/it/plugins/highlight/loader/prettify.js","#markdown/it/plugins/highlight/loader/run_prettify.js?skin=sons-of-obsidian"];App.loader.libs.powerFloat=["#float/powerFloat.min.css","#float/powerFloat.min.js"];App.loader.libs.uploadPreviewer=["#jquery.uploadPreviewer/css/jquery.uploadPreviewer.min.css","#jquery.uploadPreviewer/jquery.uploadPreviewer.min.js"];window.UEDITOR_HOME_URL=ASSETS_URL+"/js/editor/ueditor/";App.editor={browsingFileURL:App.loader.siteURL+(typeof window.IS_BACKEND!=="undefined"&&window.IS_BACKEND?"":"/user")+"/finder"};App.editor.ueditors=function(e,t,i){$(e).each(function(){App.editor.ueditor(this,t,i)})};App.editor.ueditor=function(e,t,i){if($(e).hasClass("form-control"))$(e).removeClass("form-control");if(!t)t=$(e).attr("action");if(i==null)i={};App.loader.defined(typeof window.UE,"ueditor");if(t){if(t.substr(0,1)=="!")t=t.substr(1);if(t.indexOf("?")>=0){t+="&"}else{t+="?"}t+="format=json&";t+="client=webuploader";i.serverUrl=t}var a=$(e).attr("id");if(!a){a="ueditor-instance-"+App.utils.unixtime();$(e).attr("id",a)}var r=UE.getEditor(a,i);$(e).data("editor-name","ueditor");$(e).data("editor-object",r)};App.editor.markdownReset=function(){var e=BACKEND_URL+"/public/assets/backend/js/editor/markdown/";editormd.emoji.path=e+"images/emojis/";editormd.katexURL.css=e+"lib/katex/katex.min";editormd.katexURL.js=e+"lib/katex/katex.min"};App.editor.markdownToHTML=function(e,a,t){if(typeof e=="object"){e=e.attr("id")}else if(e.substr(0,1)=="#"){e=e.substr(1)}var i=function(e){var t={markdown:a,htmlDecode:"style,script,iframe|on*",toc:true,tocm:true,emoji:true,taskList:true,tex:true,flowChart:true,sequenceDiagram:true};var i=$.extend({},t,e||{});App.loader.defined(typeof marked,"editormdPreview",null,function(){App.editor.markdownReset()});if(i.flowChart)App.loader.defined(typeof $.fn.flowChart,"flowChart");if(i.sequenceDiagram)App.loader.defined(typeof $.fn.sequenceDiagram,"sequenceDiagram");return i};var r="markdown-render-processing-"+App.utils.unixtime();var o='<div id="'+r+'"><i class="fa fa-spinner fa-spin fa-3x"></i></div>';if(a==null||typeof a=="boolean"){var n=a,d=$("#"+e);if(n!=false)d=$("#"+e).find(".markdown-code");d.first().before(o);var l=i(t);d.each(function(){if($(this).children("textarea").length>0){l.markdown=$(this).children("textarea").text()}else{l.markdown=$(this).text()}editormd.markdownToHTML(this,l)});$("#"+r).remove();return}$("#"+e).before(o);var l=i(t);var p=editormd.markdownToHTML(e,l);$("#"+r).remove();return p};App.editor.markdowns=function(e,t,i){$(e).each(function(){App.editor.markdown(this,t,i)})};App.editor.markdown=function(e,t,i){var a=false;if(!t)t=$(e).attr("action");App.loader.defined(typeof editormd,"editormd",null,function(){App.editor.markdownReset()});if(t){if(t.substr(0,1)=="!"){t=t.substr(1);a=true}if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(!a)t+="format=json&";t+="filetype=image&client=markdown"}var r=function(t){App.editor.finderDialog(App.editor.browsingFileURL+"?from=parent&size=12&filetype=image&multiple=0",function(e){if(e.length<=0){return App.message({type:"error",text:App.t("没有选择任何选项！")})}t.dialog.find("[data-url]").val(e[0])},1e5)};var o=$(e).parent(),n=o.attr("id");if(n===undefined){n="webx-md-"+App.utils.unixtime();o.attr("id",n)}var d=BACKEND_URL+"/public/assets/backend/js/editor/markdown/";var l={width:"100%",height:o.height(),path:d+"lib/",markdown:$(e).val(),codeFold:true,saveHTMLToTextarea:true,searchReplace:true,watch:true,htmlDecode:"style,script,iframe|on*",emoji:true,taskList:true,tocm:true,tex:true,flowChart:true,sequenceDiagram:true,imageUpload:true,imageFormats:["jpg","jpeg","gif","png","bmp"],imageUploadURL:t,imageBrowseFn:r,crossDomainUpload:true,uploadCallbackURL:d+"plugins/image-dialog/upload_callback.htm",dialogLockScreen:false,onload:function(){}};var p=$.extend({},l,i||{});if(a){p.toolbarIcons=function(){return["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","browsing-image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info"]};p.toolbarIconsClass={"browsing-image":"fa-image"};p.toolbarIconTexts={"browsing-image":App.t("选择图片")};p.toolbarHandlers={"browsing-image":function(n,e,t,i){App.editor.finderDialog(App.editor.browsingFileURL+"?from=parent&size=12&filetype=image&multiple=1",function(e){if(e.length<=0){return App.message({type:"error",text:App.t("没有选择任何选项！")})}var t=[];for(var i=0;i<e.length;i++){var a=e[i],r=String(a).split("/");var o=r.length>0?r[r.length-1]:a;t.push("!["+o+"]("+a+")")}t=t.join("\n")+"\n";n.replaceSelection(t)})}};p.lang={toolbar:{"browsing-image":App.t("从服务器选择图片")}}}if(!t)p.imageUpload=false;var s=editormd(n,p);$(e).data("editor-name","markdown");$(e).data("editor-object",s);return s};App.editor.md=App.editor.markdown;App.editor.xheditors=function(e,t,i){$(e).each(function(){App.editor.xheditor(this,t,i)})};App.editor.xheditor=function(e,t,i){App.loader.defined(typeof $.fn.xheditor,"xheditor");if(!t)t=$(e).attr("action");var a,r=BACKEND_URL+"/public/assets/backend/js/editor/xheditor/";if(!t){a=$(e).xheditor({editorRoot:r})}else{if(t.indexOf("?")>=0){t+="&"}else{t+="?"}if(t.substr(0,1)=="!"){i=$.extend({modalWidth:620,modalHeight:635,upBtnText:App.t("浏览")},i||{})}else{t+="format=json&"}t+="client=xheditor";var o={Code:{c:"xhe_btnCode",t:"插入代码",h:1,e:function(){var e=this;var t=["erlang","go","html","javascript","php","scala","sql","xquery","xml","yaml","yml"];var i='<div><select id="xheCodeType">';for(var a=0;a<t.length;a++){var r=t[a]=="go"?' selected="selected"':"";i+='<option value="'+t[a]+'"'+r+">"+t[a]+"</option>"}i+='<option value="">其它</option></select></div><div><textarea id="xheCodeValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="确定" /></div>';var o=$(i),n=$("#xheCodeType",o),d=$("#xheCodeValue",o),l=$("#xheSave",o);l.click(function(){e.loadBookmark();e.pasteHTML('<pre class="prettyprint linenums lang-'+n.val()+'">'+e.domEncode(d.val())+"</pre>");e.hidePanel();return false});e.saveBookmark();e.showDialog(o)}},EndInput:{c:"xhe_btnEndInput",t:"末尾新行 (Shift+End)",s:"shift+end",e:function(){this.appendHTML("<p><br /></p>")}}};var n={skin:"default",plugins:o,upLinkUrl:t+"&filetype=file",upLinkExt:"zip,rar,7z,tar,gz,txt,xls,doc,docx,ppt,pptx,et,wps,rtf,dps",upImgUrl:t+"&filetype=image",upImgExt:"jpg,jpeg,gif,png",upFlashUrl:t+"&filetype=flash",upFlashExt:"swf",upMediaUrl:t+"&filetype=media",upMediaExt:"avi,wmv,wma,mp3,mp4,mpeg,mkv,rm,rmv,mid",editorRoot:r};n=$.extend(n,i||{});if($.browser.msie&&parseFloat($.browser.version)<10){t="!{editorRoot}xheditor_plugins/multiupload/multiupload.html?uploadurl="+encodeURIComponent(t);if(n.upLinkUrl){n.upLinkUrl=t+"&ext=Attachment("+"*."+n.upLinkExt.replace(/,/g,";*.")+")";n.upLinkExt=""}if(n.upImgUrl){n.upImgUrl=t+"&ext=Image("+"*."+n.upImgExt.replace(/,/g,";*.")+")";n.upImgExt=""}if(n.upFlashUrl){n.upFlashUrl=t+"&ext=Flash("+"*."+n.upFlashExt.replace(/,/g,";*.")+")";n.upFlashExt=""}if(n.upMediaUrl){n.upMediaUrl=t+"&ext=Media("+"*."+n.upMediaUrl.replace(/,/g,";*.")+")";n.upMediaExt=""}}a=$(e).xheditor(n)}$(e).data("editor-name","xheditor");$(e).data("editor-object",a);return a};App.editor.markdownItToHTML=function e(t,i){App.loader.defined(typeof window.markdownit,"markdownit");App.loader.defined(typeof window.prettyPrint,"codehighlight");if(typeof t!="object"){t=$(t)}if(i!=false)t=t.find(".markdown-code");var a=App.editor.markdownItInstance();t.each(function(){var e;if($(this).children("textarea").length>0){e=$(this).children("textarea").text()}else{e=$(this).text()}$(this).html(a.render($.trim(e)));$(this).find("pre > code").each(function(){$(this).parent("pre").addClass("prettyprint linenums")});if(typeof prettyPrint!=="undefined")prettyPrint()})};App.editor.markdownItInstance=function(){App.loader.defined(typeof window.markdownit,"markdownit");var e=window.markdownit();if(typeof window.markdownitEmoji!="undefined")e.use(window.markdownitEmoji);return e};App.editor.tinymces=function(e,t,i,a){$(e).each(function(){App.editor.tinymce(this,t,i,a)})};App.editor.finderDialog=function(i,a,t){if(!t)t=2e3;App.loader.defined(typeof BootstrapDialog,"dialog");var e=BootstrapDialog.show({title:App.t("选择文件"),message:function(t){var e="finderDialogCallback"+App.utils.unixtime();window[e]=function(e){a(e);if(e&&e.length>0)t.close()};return $('<iframe src="'+i+"&callback="+e+'" style="width:100%;height:635px;border:0;padding:0;margin:0"></iframe>')},onshown:function(e){e.$modal.css("zIndex",t);e.$modalBody.css("padding",0)}});return e};App.editor.tinymceOnceFix=false;App.editor.tinymce=function(e,o,t,i){if(!App.editor.tinymceOnceFix){App.editor.tinymceOnceFix=true;$(document).on("focusin",function(e){if($(e.target).closest(".tox-tinymce-aux, .moxman-window, .tam-assetmanager-root").length){e.stopImmediatePropagation()}})}App.loader.defined(typeof $.fn.tinymce,"tinymce");if(!o)o=$(e).attr("action");var a=App.editor.browsingFileURL;if(o&&o.substr(0,1)=="!"){a=o.substr(1);o=$(e).data("upload-url")}if(o){if(o.indexOf("?")>=0){o+="&"}else{o+="?"}o+="format=json&client=tinymce&filetype="}if(a){a=a.replace(/[\?&]multiple=1/,"");if(a.indexOf("?")>=0){a+="&"}else{a+="?"}a+="from=parent&client=tinymce&filetype="}var r="undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | customDateButton";var n="undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl | customDateButton";var d=function(t,e,i){switch(i.filetype){case"file":App.editor.finderDialog(a+i.filetype,function(e){if(e&&e.length>0)t(e[0],{text:"My text"})});break;case"image":App.editor.finderDialog(a+i.filetype,function(e){if(e&&e.length>0)t(e[0],{alt:""})});break;case"media":App.editor.finderDialog(a+i.filetype,function(e){if(e&&e.length>0)t(e[0],{})});break;default:alert("Unsupported file type")}};var l=function(e,t,i){var a,r;a=new XMLHttpRequest;a.withCredentials=false;a.open("POST",o);a.onload=function(){var e;if(a.status!=200){i("HTTP Error: "+a.status);return}e=JSON.parse(a.responseText);if(!e||typeof e.Code=="undefined"){i("Invalid JSON: "+a.responseText);return}if(e.Code!=1){i(e.Info);return}t(e.Data.Url)};r=new FormData;r.append("filedata",e.blob(),e.filename());a.send(r)};var p="link table";var s="bold italic | quicklink h2 h3 blockquote quicktable";var u="print preview paste importcss searchreplace autolink autosave save directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable charmap quickbars emoticons";if(o){p+=" image imagetools";s+=" quickimage"}var c={height:i?200:500,menubar:true,language:App.langTag("_"),plugins:[u],toolbar:i?r:n,toolbar_sticky:true,autosave_ask_before_unload:true,autosave_interval:"30s",autosave_prefix:"{path}{query}-{id}-",autosave_restore_when_empty:true,autosave_retention:"2m",image_advtab:true,templates:[{title:"New Table",description:"creates a new table",content:'<div class="mceTmpl"><table width="98%%" border="0" cellspacing="0" cellpadding="0"><tr><th scope="col"> </th><th scope="col"> </th></tr><tr><td> </td><td> </td></tr></table></div>'}],image_caption:true,relative_urls:false,image_title:true,quickbars_selection_toolbar:s,noneditable_noneditable_class:"mceNonEditable",toolbar_drawer:"sliding",contextmenu:p,setup:function(a){var t=function(e){return'<time datetime="'+e.toString()+'">'+e.toLocaleString()+"</time>"};a.ui.registry.addButton("customDateButton",{icon:"insert-time",tooltip:"Insert Current Date",disabled:true,onAction:function(e){a.insertContent(t(new Date))},onSetup:function(t){var i=function(e){t.setDisabled(e.element.nodeName.toLowerCase()==="time")};a.on("NodeChange",i);return function(e){a.off("NodeChange",i)}}})}};if(a)c.file_picker_callback=d;if(o)c.images_upload_handler=l;var f=App.utils.elemToId(e).replace(/^#/,"");$(e).tinymce($.extend({},c,t||{}));$(e).data("editor-name","tinymce");var m=tinymce.get(f);$(e).data("editor-object",m)};App.editor.switcher=function(e,a,r){if($(e).length<1)return;var t,i=String($(e).get(0).tagName).toLowerCase();switch(i){case"select":t="change";break;default:t="click"}$(e).on(t,function(){var e=$(this).val();var t=$(a);var i=$(this).data("editor-name")||r;t.data("editor-type",e);return App.editor.switch(i,t)});$(a).data("placeholder",$(a).attr("placeholder"));switch(i){case"input":$(e).filter(":checked").first().trigger(t);break;default:$(e).trigger(t)}};App.editor.switch=function(e,a,t,i){var r=a.attr("action")||a.data("upload-url")||"!"+App.editor.browsingFileURL+"?size=12&multiple=1",o=a.data("editor-type"),n=a.data("editor-name"),d=a.data("editor-object"),l=a.data("current-editor");if(l==o)return;var p=a.data("class");if(p===undefined){p=a.attr("class");if(!p)p="";a.data("class",p)}var s=a.data("content-elem"),u=s;if(s)u=App.loader.parseTmpl(s,{type:o});var c=a.get(0);var f=function(){switch(n){case"xheditor":if(typeof a.xheditor!="undefined")a.xheditor(false);break;case"ueditor":d&&d.destroy();break;case"tinymce":d&&d.remove();break;default:}};var m=function(e){var t=a.data(e+"-options")||{};switch(e){case"ueditor":App.editor.ueditor(c,r,t);break;case"tinymce":App.editor.tinymce(c,r,t);var i=window.setInterval(function(){if(a.next(".tox-tinymce").length>0){a.next(".tox-tinymce").show();window.clearInterval(i)}},100);break;default:App.editor.xheditor(c,r,t)}};var h=function(){var e=a.data("markdown-options")||{};App.editor.markdown(c,r,e)};var g=function(){if(u&&$(u).length>0){var e=App.loader.parseTmpl(s,{type:l});if(e&&$(e).length>0){$(e).text(a.val());var t=$('textarea[name="'+a.parent().attr("id")+'-html-code"]');if(t.length>0&&t.val()!=""){$(u).text(t.val());$(u).val(t.val())}}a.val($(u).val());a.text($(u).val())}a.parent().removeAttr("class");a.attr("class",p).siblings().remove()};switch(o){case"markdown":if(i){var v=App.loader.parseTmpl(s,{type:l});if(v&&$(v).length>0){if(a.val()!=$(v).val()&&!confirm("确定要切换吗？切换编辑器将会丢失您当前所做的修改。")){if(t!=null)t();return false}}}if(u&&$(u).length>0){a.text($(u).val());a.val($(u).val())}f();h();a.data("current-editor-type",o);break;case"text":f();g();a.attr("placeholder",a.data("placeholder")||"").show().focus();a.data("current-editor-type",o);break;default:g();m(e);a.data("current-editor-type","html")}return true};if(typeof App.utils=="undefined")App.utils={};App.utils.elemToId=function(e){if(typeof e!="object"){if(String(e).substring(0,1)!="#"){e="#"+e}return e}var t=$(e).attr("id");if(t)return"#"+t;t="generated-id-"+App.utils.unixtime();$(e).attr("id",t);return"#"+t};App.utils.unixtime=function(){return(new Date).getTime()};App.editor.fileInput=function(e){if(!e){e=""}else{e=App.utils.elemToId(e)+" "}App.loader.defined(typeof $.fn.powerFloat,"powerFloat");App.loader.defined(typeof $.fn.uploadPreviewer,"uploadPreviewer");$(e+'[data-toggle="finder"]').each(function(){$(this).on("click",function(e){var t=$(this).data("finder-url")||App.editor.browsingFileURL;if(!t)return;t=t.replace(/[\?&]multiple=1/,"");if(t.indexOf("?")>=0){t+="&"}else{t+="?"}t+="from=parent&client=fileInput&filetype=image";var r=this;App.editor.finderDialog(t,function(e){var t=e[0];var i=$(r).data("input");if(!i){i=$(r).parent(".input-group-btn").siblings("input")[0]}if(i)$(i).val(t);var a=$(r).data("preview-btn");if(!a){a=$(r).parent(".input-group-btn").siblings(".preview-btn")[0]}if(a){if(!$(a).data("attached-float")){App.float(App.utils.elemToId(a)+" a img");$(a).data("attached-float",true)}$(a).removeClass("hidden").children("a").attr("href",t).children("img").attr("src",t)}})})});$(e+'input[data-toggle="uploadPreviewer"]').each(function(){$(this).css("width","70px");var e=$(this).data("preview-container");var t=$(this).data("upload-url");var i=$(this).data("preview-btn");var a=$(this).uploadPreviewer({buttonText:'<i class="fa fa-cloud-upload"></i> '+App.t("上传"),previewTableContainer:e,url:t,previewTableShow:false});$(this).data("uploadPreviewer",a);if(i&&!$(i).data("attached-float")){App.float(App.utils.elemToId(i)+" a img");$(i).data("attached-float",true)}$(this).on("file-preview:changed",function(r){$(r.target).data("uploadPreviewer").submit(function(e){if(e.Code!=1)return App.message({text:e.Info,type:"error"});var t=e.Data.files[0];var i=$(r.target).data("input");if(!i){i=$(r.target).parents(".input-group-btn").prev("input")[0]}$(i).val(t);var a=$(r.target).data("preview-btn");if(!a){a=$(r.target).parents(".input-group-btn").siblings(".preview-btn")[0]}if(a){if(!$(a).data("attached-float")){App.float(App.utils.elemToId(a)+" a img");$(a).data("attached-float",true)}$(a).removeClass("hidden").children("a").attr("href",t).children("img").attr("src",t)}App.message({text:App.t("上传成功"),type:"success"})})})})};