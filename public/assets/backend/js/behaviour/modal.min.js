(function(){function e(i,e,a,n){var r=i.find(".modal-body .nav-tabs>li");i.find(".modal-footer").removeClass("hidden");if(n==null)n=[0];r.on("click",function(){var e=r.index(this),a=false;for(var t=0;t<n.length;t++){if(e==n[t]){a=true;break}}if(a){i.find(".modal-footer").removeClass("hidden")}else{i.find(".modal-footer:not(.hidden)").addClass("hidden")}});i.find("table[data-page-size]").each(function(){f($(this),e,a)})}function f(i,n,r){if(!i||i.length<1)return;var l=i.data(),a=null;if(r){if(l.ajaxList&&l.ajaxList in r)r[l.ajaxList](i);if("switchPage"in r)a=r["switchPage"];if("pageData"in r)l=typeof r["pageData"]=="function"?r["pageData"](i):r["pageData"]}App.withPagination(l,null);i.after(l.pagination);if(!a){a=function(e){var a={ajaxList:l.ajaxList,page:e};a=$.extend(a,n||{});var t=typeof l["pageUrl"]!="undefined"?l["pageUrl"]:window.location.href;$.get(t,a,function(e){var a=i.parent();a.html(e);f(a.children("table[data-page-size]"),n,r)},"html")}}var e=i.next("ul.pagination");e.find("li > a[page]").on("click",function(){if($(this).closest("li.disabled").length>0)return;a($(this).attr("page"))});e.on("refresh",function(){var e=1;if($(this).data("page")){e=$(this).data("page");$(this).data("page",false)}else{e=$(this).find("li.active > a[page]").data("page")||1}a(e)})}function x(e,a){e=e.substring((a+"[").length);return e.substring(0,e.length-1)}function L(e,a){if(e.length<1)return;switch(e[0].tagName.toLowerCase()){case"input":var t=e.attr("type");if(t==="checkbox"){e.prop("checked",false);if(a===undefined||a===null)return;e.filter('[value="'+a+'"]').prop("checked",true)}else if(t==="radio"){if(a===undefined||a===null)return;e.filter('[value="'+a+'"]').prop("checked",true)}else{if(a===undefined||a===null)return;e.val(a)}break;case"select":if(a===undefined||a===null)return;e.find('option[value="'+a+'"]').prop("selected",true);break;default:if(a===undefined||a===null)return;e.val(a);break}}function C(e){if(e.length<1)return;var a=e.attr("type");switch(e[0].tagName.toLowerCase()){case"input":if(a==="checkbox"){if(e.attr("name").endsWith("[]")){var t=[];e.filter(":checked").each(function(){t.push($(this).val())});return t}return e.filter(":checked:last").val()}else if(a==="radio"){return e.filter(":checked").val()}return e.val();case"select":return e.val();default:return e.val()}}function a(f,u,d,e,o,s){if(typeof d=="object"&&d!==null){var a=d;var d=null;if("fields"in a)d=a.fields;if("afterOpenCallback"in a)e=a.afterOpenCallback;if("onSubmitCallback"in a)o=a.onSubmitCallback;if("multilingualFieldPrefix"in a)s=a.multilingualFieldPrefix}var t=f.data("modal-title"),i=f.data("form-data"),r=u.find("form");var n=u.find(".modal-header h3"),l=n.data("original-title");if(t){if(!l)n.data("original-title",n.html());n.html(t)}else if(l){n.html(l);n.data("original-title",null)}r[0].reset();var c=u.find(".langset").length>0,h="";if(c){var v=u.find(".langset > .nav-tabs > li:first");if(!v.hasClass("active")){v.children("a").trigger("click")}h=v.children("a").data("lang")}if(i){for(var p in i){L(r.find('[name="'+p+'"]'),i[p])}}var g;if(d&&d.length>0){g=function(){return d}}else if(c){if(!s)s="Language";g=function(){var t=s+"["+h+"]";var i=[],n={};r.find("[name]").each(function(){var e=$(this).attr("name");var a=e;if(e.startsWith(s+"[")){if(e.startsWith(t)){a=x(e,t)}else{return}}if(n[a])return;n[a]=true;i.push(a)});return i}}else{g=function(){var a=[],t={};r.find("[name]").each(function(){var e=$(this).attr("name");if(t[e])return;t[e]=true;a.push(e)});return a}}if(e){var m;if(c&&h){m=function(e){var a="Language["+h+"]["+e+"]";if(r.find('[name="'+a+'"]').length>0)return a;return e}}else{m=function(e){return e}}var k=e(f,u,{formData:i,multilingual:c,langDefault:h,getModalFieldName:m,getFields:g});if(k){var d=g();for(var b in d){var y=k(d[b]);if(y&&typeof y=="object")y=C(y);L(r.find('[name="'+m(d[b])+'"]'),k(d[b]))}}}var w=u.find(".modal-footer .btn-primary");w.off("click").on("click",function(){var e=u.find("form"),t={};e.find("[name]").each(function(){var e=$(this).attr("name");if(!e)return;switch(this.tagName.toLowerCase()){case"input":switch(this.type){case"checkbox":if(!this.checked)return;if(e.endsWith("[]")){if(!t[e])t[e]=[];t[e].push($(this).val())}else{t[e]=$(this).val()}return;case"radio":if(!this.checked)return;t[e]=$(this).val();return;case"button":return;default:t[e]=$(this).val()}break;default:t[e]=$(this).val();break}});var i={data:t,multilingual:c};if(c){if(!s)s="Language";if(!d){var n=s+"["+h+"]";e.find("[name]").each(function(){var e=$(this).attr("name");var a=e;if(e.startsWith(s+"[")){if(e.startsWith(n)){a=x(e,n)}else{return}}i[a]=t[e]})}else{for(var a=0;a<d.length;a++){var r=d[a];i[r]=t[s+"["+h+"]["+r+"]"]}}i.langDefault=h}else{if(!d){for(var l in t){i[l]=t[l]}}else{for(var a=0;a<d.length;a++){var r=d[a];i[r]=t[r]}}}if(o)o(f,u,i)})}function t(e,a,t,i,n){var r="Language[",l="",f="";if(t){for(var u=0;u<t.length;u++){l+="["+t[u]+"]";if(u==0){f+=t[u]}else{f+="["+t[u]+"]"}}}for(var d in a.data){if(!d.startsWith(r))continue;var o=d.substring(r.length);o=o.substring(0,o.length-1);var s=o.split("][");if(s.length!=2)continue;if(s[0]==a.langDefault)continue;if(i)s[1]=i(s[1]);var c="Language"+l+"["+s[0]+"]["+s[1]+"]",h=e.find('input[type=hidden][name="'+c+'"]');if(h.length>0){h.val(a.data[d]);continue}e.prepend('<input type="hidden" name="'+c+'" value="'+a.data[d]+'" />')}var v;if(f){v=function(e){return f+"["+e+"]"}}else{v=function(e){return e}}var c=v("translate"),h=e.find('input[type=hidden][name="'+c+'"]'),p="forceTranslate"in a.data?a.data.forceTranslate:"";if(h.length>0){h.val(p)}else{e.prepend('<input type="hidden" name="'+c+'" value="'+p+'" />')}if(n){for(var d in a){if(d=="data"||d=="langDefault"||d=="multilingual")continue;if(i)d=i(d);var g=n.find('[name="'+v(d)+'"]');if(g.length==0)continue;var m=g.attr("type");switch(m){case"radio":g.filter('[value="'+a[d]+'"]').prop("checked",true);break;case"checkbox":g.prop("checked",false);if(typeof a[d]=="array"){for(var u=0;u<a[d].length;u++){g.filter('[value="'+a[d][u]+'"]').prop("checked",true)}}else{g.filter('[value="'+a[d]+'"]').prop("checked",true)}break;default:if(g[0].tagName.toLowerCase()=="select"){g.find('option[value="'+a[d]+'"]').prop("selected",true)}else{g.val(a[d])}break}}}}App.initModalBody=e;App.initModalBodyPagination=f;App.initModalForm=a;App.updateMultilingualFormByModal=t;App.getFormFieldValue=C;App.setFormFieldValue=L})();