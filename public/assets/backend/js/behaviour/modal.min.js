(function(){function a(t,a,i,n){var l=t.find(".modal-body .nav-tabs>li");t.find(".modal-footer").removeClass("hidden");if(n==null)n=[0];l.on("click",function(){var a=l.index(this),i=false;for(var e=0;e<n.length;e++){if(a==n[e]){i=true;break}}if(i){t.find(".modal-footer").removeClass("hidden")}else{t.find(".modal-footer:not(.hidden)").addClass("hidden")}});t.find("table[data-page-size]").each(function(){f($(this),a,i)})}function f(t,n,l){if(!t||t.length<1)return;var r=t.data(),i=null;if(l){if(r.ajaxList&&r.ajaxList in l)l[r.ajaxList](t);if("switchPage"in l)i=l["switchPage"];if("pageData"in l)r=typeof l["pageData"]=="function"?l["pageData"](t):l["pageData"]}App.withPagination(r,null);t.after(r.pagination);if(!i){i=function(a){var i={ajaxList:r.ajaxList,page:a};i=$.extend(i,n||{});var e=typeof r["pageUrl"]!="undefined"?r["pageUrl"]:window.location.href;$.get(e,i,function(a){var i=t.parent();i.html(a);f(i.children("table[data-page-size]"),n,l)},"html")}}var a=t.next("ul.pagination");a.find("li > a[page]").on("click",function(){if($(this).closest("li.disabled").length>0)return;i($(this).attr("page"))});a.on("refresh",function(){var a=1;if($(this).data("page")){a=$(this).data("page");$(this).data("page",false)}else{a=$(this).find("li.active > a[page]").data("page")||1}i(a)})}function i(f,d,o,a,u,s){if(typeof o=="object"&&o!==null){var i=o;var o=null;if("fields"in i)o=i.fields;if("afterOpenCallback"in i)a=i.afterOpenCallback;if("onSubmitCallback"in i)u=i.onSubmitCallback;if("multilingualFieldPrefix"in i)s=i.multilingualFieldPrefix}var e=f.data("modal-title"),t=f.data("form-data"),l=d.find("form");var n=d.find(".modal-header h3"),r=n.data("original-title");if(e){if(!r)n.data("original-title",n.html());n.html(e)}else if(r){n.html(r);n.data("original-title",null)}l[0].reset();var c=d.find(".langset").length>0,h="";if(c){var g=d.find(".langset > .nav-tabs > li:first");if(!g.hasClass("active")){g.children("a").trigger("click")}h=g.children("a").data("lang")}if(t){for(var p in t){var v=t[p],m=l.find('[name="'+p+'"]:first');if(m.length<1)continue;var b=m.attr("type");switch(m[0].tagName.toLowerCase()){case"input":if(b==="checkbox"||b==="radio"){l.find('[name="'+p+'"][value="'+v+'"]').prop("checked",true)}else{m.val(v)}break;default:m.val(v);break}}}var k;if(o&&o.length>0){k=function(){return o}}else if(c){if(!s)s="Language";k=function(){var e=s+"["+h+"]";var t=[],n={};l.find('[name^="'+e+'"]').each(function(){var a=$(this).attr("name"),i=a.replace(e+"[","").replace("]","");if(n[i])return;n[i]=true;t.push(i)});return t}}else{k=function(){var i=[],e={};l.find("[name]").each(function(){var a=$(this).attr("name");if(e[a])return;e[a]=true;i.push(a)});return i}}if(a){var y;if(c&&h){y=function(a){return"Language["+h+"]["+a+"]"}}else{y=function(a){return a}}a(f,d,{formData:t,multilingual:c,langDefault:h,getModalFieldName:y,getFields:k})}var x=d.find(".modal-footer .btn-primary");x.off("click").on("click",function(){var a=d.find("form"),e={};a.find("input,select,textarea").each(function(){var a=$(this).attr("name"),i="";switch(this.tagName.toLowerCase()){case"input":if(this.type==="checkbox"||this.type==="radio"){if(!this.checked)return}else if(this.type==="button"){return}i=$(this).val();break;default:i=$(this).val();break}if(a)e[a]=i});var t={data:e,multilingual:c};if(c){if(!s)s="Language";if(!o){var n=s+"["+h+"]";a.find('[name^="'+n+'"]').each(function(){var a=$(this).attr("name"),i=a.replace(n+"[","").replace("]","");t[i]=e[a]})}else{for(var i=0;i<o.length;i++){var l=o[i];t[l]=e[s+"["+h+"]["+l+"]"]}}t.langDefault=h}else{if(!o){for(var r in e){t[r]=e[r]}}else{for(var i=0;i<o.length;i++){var l=o[i];t[l]=e[l]}}}if(u)u(f,d,t)})}function e(a,i,e,t,n){var l="Language[",r="",f="";if(e){for(var d=0;d<e.length;d++){r+="["+e[d]+"]";if(d==0){f+=e[d]}else{f+="["+e[d]+"]"}}}for(var o in i.data){if(!o.startsWith(l))continue;var u=o.substring(l.length);u=u.substring(0,u.length-1);var s=u.split("][");if(s.length!=2)continue;if(s[0]==i.langDefault)continue;if(t)s[1]=t(s[1]);var c="Language"+r+"["+s[0]+"]["+s[1]+"]",h=a.find('input[type=hidden][name="'+c+'"]');if(h.length>0){h.val(i.data[o]);continue}a.prepend('<input type="hidden" name="'+c+'" value="'+i.data[o]+'" />')}var c=f+"[translate]",h=a.find('input[type=hidden][name="'+c+'"]'),g="forceTranslate"in i.data?i.data.forceTranslate:"";if(h.length>0){h.val(g)}else{a.prepend('<input type="hidden" name="'+c+'" value="'+g+'" />')}if(n){for(var o in i){if(o=="data"||o=="langDefault"||o=="multilingual")continue;if(t)o=t(o);$h.find('input[name="'+f+"["+o+']"]').val(i[o])}}}App.initModalBody=a;App.initModalBodyPagination=f;App.initModalForm=i;App.updateMultilingualFormByModal=e})();