(function(){function a(i,a,e,n){var r=i.find(".modal-body .nav-tabs>li");i.find(".modal-footer").removeClass("hidden");if(n==null)n=[0];r.on("click",function(){var a=r.index(this),e=false;for(var t=0;t<n.length;t++){if(a==n[t]){e=true;break}}if(e){i.find(".modal-footer").removeClass("hidden")}else{i.find(".modal-footer:not(.hidden)").addClass("hidden")}});i.find("table[data-page-size]").each(function(){f($(this),a,e)})}function f(i,n,r){if(!i||i.length<1)return;var l=i.data(),e=null;if(r){if(l.ajaxList&&l.ajaxList in r)r[l.ajaxList](i);if("switchPage"in r)e=r["switchPage"];if("pageData"in r)l=typeof r["pageData"]=="function"?r["pageData"](i):r["pageData"]}App.withPagination(l,null);i.after(l.pagination);if(!e){e=function(a){var e={ajaxList:l.ajaxList,page:a};e=$.extend(e,n||{});var t=typeof l["pageUrl"]!="undefined"?l["pageUrl"]:window.location.href;$.get(t,e,function(a){var e=i.parent();e.html(a);f(e.children("table[data-page-size]"),n,r)},"html")}}var a=i.next("ul.pagination");a.find("li > a[page]").on("click",function(){if($(this).closest("li.disabled").length>0)return;e($(this).attr("page"))});a.on("refresh",function(){var a=1;if($(this).data("page")){a=$(this).data("page");$(this).data("page",false)}else{a=$(this).find("li.active > a[page]").data("page")||1}e(a)})}function L(a,e){a=a.substring((e+"[").length);return a.substring(0,a.length-1)}function e(f,u,o,a,s,d){if(typeof o=="object"&&o!==null){var e=o;var o=null;if("fields"in e)o=e.fields;if("afterOpenCallback"in e)a=e.afterOpenCallback;if("onSubmitCallback"in e)s=e.onSubmitCallback;if("multilingualFieldPrefix"in e)d=e.multilingualFieldPrefix}var t=f.data("modal-title"),i=f.data("form-data"),r=u.find("form");var n=u.find(".modal-header h3"),l=n.data("original-title");if(t){if(!l)n.data("original-title",n.html());n.html(t)}else if(l){n.html(l);n.data("original-title",null)}r[0].reset();var c=u.find(".langset").length>0,h="";if(c){var g=u.find(".langset > .nav-tabs > li:first");if(!g.hasClass("active")){g.children("a").trigger("click")}h=g.children("a").data("lang")}if(i){for(var v in i){var p=i[v],m=r.find('[name="'+v+'"]:first');if(m.length<1)continue;var b=m.attr("type");switch(m[0].tagName.toLowerCase()){case"input":if(b==="checkbox"||b==="radio"){r.find('[name="'+v+'"][value="'+p+'"]').prop("checked",true)}else{m.val(p)}break;default:m.val(p);break}}}var k;if(o&&o.length>0){k=function(){return o}}else if(c){if(!d)d="Language";k=function(){var t=d+"["+h+"]";var i=[],n={};r.find("[name]").each(function(){var a=$(this).attr("name");var e=a;if(a.startsWith(d+"[")){if(a.startsWith(t)){e=L(a,t)}else{return}}if(n[e])return;n[e]=true;i.push(e)});return i}}else{k=function(){var e=[],t={};r.find("[name]").each(function(){var a=$(this).attr("name");if(t[a])return;t[a]=true;e.push(a)});return e}}if(a){var y;if(c&&h){y=function(a){var e="Language["+h+"]["+a+"]";if(r.find('[name="'+e+'"]').length>0)return e;return a}}else{y=function(a){return a}}a(f,u,{formData:i,multilingual:c,langDefault:h,getModalFieldName:y,getFields:k})}var x=u.find(".modal-footer .btn-primary");x.off("click").on("click",function(){var a=u.find("form"),t={};a.find("input,select,textarea").each(function(){var a=$(this).attr("name");if(!a)return;switch(this.tagName.toLowerCase()){case"input":switch(this.type){case"checkbox":if(!this.checked)return;if(a.endsWith("]")){if(!t[a])t[a]=[];t[a].push($(this).val())}else{t[a]=$(this).val()}return;case"radio":if(!this.checked)return;t[a]=$(this).val();return;case"button":return;default:t[a]=$(this).val()}break;default:t[a]=$(this).val();break}});var i={data:t,multilingual:c};if(c){if(!d)d="Language";if(!o){var n=d+"["+h+"]";a.find("[name]").each(function(){var a=$(this).attr("name");var e=a;if(a.startsWith(d+"[")){if(a.startsWith(n)){e=L(a,n)}else{return}}i[e]=t[a]})}else{for(var e=0;e<o.length;e++){var r=o[e];i[r]=t[d+"["+h+"]["+r+"]"]}}i.langDefault=h}else{if(!o){for(var l in t){i[l]=t[l]}}else{for(var e=0;e<o.length;e++){var r=o[e];i[r]=t[r]}}}if(s)s(f,u,i)})}function t(a,e,t,i,n){var r="Language[",l="",f="";if(t){for(var u=0;u<t.length;u++){l+="["+t[u]+"]";if(u==0){f+=t[u]}else{f+="["+t[u]+"]"}}}for(var o in e.data){if(!o.startsWith(r))continue;var s=o.substring(r.length);s=s.substring(0,s.length-1);var d=s.split("][");if(d.length!=2)continue;if(d[0]==e.langDefault)continue;if(i)d[1]=i(d[1]);var c="Language"+l+"["+d[0]+"]["+d[1]+"]",h=a.find('input[type=hidden][name="'+c+'"]');if(h.length>0){h.val(e.data[o]);continue}a.prepend('<input type="hidden" name="'+c+'" value="'+e.data[o]+'" />')}var g;if(f){g=function(a){return f+"["+a+"]"}}else{g=function(a){return a}}var c=g("translate"),h=a.find('input[type=hidden][name="'+c+'"]'),v="forceTranslate"in e.data?e.data.forceTranslate:"";if(h.length>0){h.val(v)}else{a.prepend('<input type="hidden" name="'+c+'" value="'+v+'" />')}if(n){for(var o in e){if(o=="data"||o=="langDefault"||o=="multilingual")continue;if(i)o=i(o);var p=n.find('input[name="'+g(o)+'"]');if(p.length==0)continue;var m=p.attr("type");switch(m){case"radio":p.filter('[value="'+e[o]+'"]').prop("checked",true);break;case"checkbox":p.prop("checked",false);if(typeof e[o]=="array"){for(var u=0;u<e[o].length;u++){p.filter('[value="'+e[o][u]+'"]').prop("checked",true)}}else{p.filter('[value="'+e[o]+'"]').prop("checked",true)}break;case"select":p.find('option[value="'+e[o]+'"]').prop("selected",true);break;default:p.val(e[o]);break}}}}App.initModalBody=a;App.initModalBodyPagination=f;App.initModalForm=e;App.updateMultilingualFormByModal=t})();