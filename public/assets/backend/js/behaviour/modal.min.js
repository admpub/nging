(function(){function a(t,a,e,n){var r=t.find(".modal-body .nav-tabs>li");t.find(".modal-footer").removeClass("hidden");if(n==null)n=[0];r.on("click",function(){var a=r.index(this),e=false;for(var i=0;i<n.length;i++){if(a==n[i]){e=true;break}}if(e){t.find(".modal-footer").removeClass("hidden")}else{t.find(".modal-footer:not(.hidden)").addClass("hidden")}});t.find("table[data-page-size]").each(function(){f($(this),a,e)})}function f(t,n,r){if(!t||t.length<1)return;var l=t.data(),e=null;if(r){if(l.ajaxList&&l.ajaxList in r)r[l.ajaxList](t);if("switchPage"in r)e=r["switchPage"];if("pageData"in r)l=typeof r["pageData"]=="function"?r["pageData"](t):r["pageData"]}App.withPagination(l,null);t.after(l.pagination);if(!e){e=function(a){var e={ajaxList:l.ajaxList,page:a};e=$.extend(e,n||{});var i=typeof l["pageUrl"]!="undefined"?l["pageUrl"]:window.location.href;$.get(i,e,function(a){var e=t.parent();e.html(a);f(e.children("table[data-page-size]"),n,r)},"html")}}var a=t.next("ul.pagination");a.find("li > a[page]").on("click",function(){if($(this).closest("li.disabled").length>0)return;e($(this).attr("page"))});a.on("refresh",function(){var a=1;if($(this).data("page")){a=$(this).data("page");$(this).data("page",false)}else{a=$(this).find("li.active > a[page]").data("page")||1}e(a)})}function L(a,e){a=a.substring((e+"[").length);return a.substring(0,a.length-1)}function C(a,e){if(a.length<1)return;switch(a[0].tagName.toLowerCase()){case"input":var i=a.attr("type");if(i==="checkbox"){a.prop("checked",false);if(e===undefined||e===null)return;a.filter('[value="'+e+'"]').prop("checked",true)}else if(i==="radio"){if(e===undefined||e===null)return;a.filter('[value="'+e+'"]').prop("checked",true)}else{if(e===undefined||e===null)return;a.val(e)}break;case"select":if(e===undefined||e===null)return;a.find('option[value="'+e+'"]').prop("selected",true);break;default:if(e===undefined||e===null)return;a.val(e);break}}function F(a){if(a.length<1)return;var e=a.attr("type");switch(a[0].tagName.toLowerCase()){case"input":if(e==="checkbox"){if(a.attr("name").endsWith("[]")){var i=[];a.filter(":checked").each(function(){i.push($(this).val())});return i}return a.filter(":checked:last").val()}else if(e==="radio"){return a.filter(":checked").val()}return a.val();case"select":return a.val();default:return a.val()}}function e(u,d,o,a,s,c){if(typeof o=="object"&&o!==null){var e=o;var o=null;if("fields"in e)o=e.fields;if("afterOpenCallback"in e)a=e.afterOpenCallback;if("onSubmitCallback"in e)s=e.onSubmitCallback;if("multilingualFieldPrefix"in e)c=e.multilingualFieldPrefix}var i=u.data("modal-title"),t=u.data("form-data"),r=d.find("form");var n=d.find(".modal-header h3"),l=n.data("original-title");if(i){if(!l)n.data("original-title",n.html());n.html(i)}else if(l){n.html(l);n.data("original-title",null)}r[0].reset();var g=d.find(".langset").length>0,h="";if(g){var f=d.find(".langset > .nav-tabs > li:first");if(!f.hasClass("active")){f.children("a").trigger("click")}h=f.children("a").data("lang")}if(t){for(var v in t){C(r.find('[name="'+v+'"]'),t[v])}}var p;if(o&&o.length>0){p=function(){return o}}else if(g){if(!c)c="Language";p=function(){var i=c+"["+h+"]";var t=[],n={};r.find("[name]").each(function(){var a=$(this).attr("name");var e=a;if(a.startsWith(c+"[")){if(a.startsWith(i)){e=L(a,i)}else{return}}if(n[e])return;n[e]=true;t.push(e)});return t}}else{p=function(){var e=[],i={};r.find("[name]").each(function(){var a=$(this).attr("name");if(i[a])return;i[a]=true;e.push(a)});return e}}if(a){var m;if(g&&h){m=function(a){var e="Language["+h+"]["+a+"]";if(r.find('[name="'+e+'"]').length>0)return e;return a}}else{m=function(a){return a}}var b=a(u,d,{formData:t,multilingual:g,langDefault:h,getModalFieldName:m,getFields:p});if(b){var o=p();for(var k in o){var y=b(o[k]);if(y&&typeof y=="object")y=F(y);C(r.find('[name="'+m(o[k])+'"]'),y)}}}var x=d.find(".modal-footer .btn-primary");x.off("click").on("click",function(){var e=d.find("form"),i={};e.find("[name]").each(function(){var a=$(this).attr("name");if(!a)return;if(a in i)return;i[a]=F(e.find('[name="'+a+'"]'))});var a={data:i,multilingual:g};if(g){if(!c)c="Language";if(!o){var t=c+"["+h+"]";for(var n in i){var r=n;if(n.startsWith(c+"[")){if(n.startsWith(t)){r=L(n,t)}else{return}}a[r]=i[n]}}else{for(var l=0;l<o.length;l++){var r=o[l];var f=c+"["+h+"]["+r+"]";if(f in i){a[r]=i[f]}else{a[r]=i[r]}}}a.langDefault=h}else{if(!o){for(var n in i){a[n]=i[n]}}else{for(var l=0;l<o.length;l++){var r=o[l];a[r]=i[r]}}}if(s)s(u,d,a)})}function i(a,e,i,t,n){var r="Language[",l="",f="";if(i){for(var u=0;u<i.length;u++){l+="["+i[u]+"]";if(u==0){f+=i[u]}else{f+="["+i[u]+"]"}}}for(var d in e.data){if(!d.startsWith(r))continue;var o=d.substring(r.length);o=o.substring(0,o.length-1);var s=o.split("][");if(s.length!=2)continue;if(s[0]==e.langDefault)continue;if(t)s[1]=t(s[1]);var c="Language"+l+"["+s[0]+"]["+s[1]+"]",g=a.find('input[type=hidden][name="'+c+'"]');if(g.length>0){g.val(e.data[d]);continue}a.prepend('<input type="hidden" name="'+c+'" value="'+e.data[d]+'" />')}var h;if(f){h=function(a){return f+"["+a+"]"}}else{h=function(a){return a}}var c=h("translate"),g=a.find('input[type=hidden][name="'+c+'"]'),v="forceTranslate"in e.data?e.data.forceTranslate:"";if(g.length>0){g.val(v)}else{a.prepend('<input type="hidden" name="'+c+'" value="'+v+'" />')}if(n){for(var d in e){if(d=="data"||d=="langDefault"||d=="multilingual")continue;var v=e[d];if(t)d=t(d);var p=n.find('[name="'+h(d)+'"]');C(p,v)}}}App.initModalBody=a;App.initModalBodyPagination=f;App.initModalForm=e;App.updateMultilingualFormByModal=i;App.getFormFieldValue=F;App.setFormFieldValue=C})();