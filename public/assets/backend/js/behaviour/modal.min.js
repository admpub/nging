(function(){function e(i,e,a,n){var r=i.find(".modal-body .nav-tabs>li");i.find(".modal-footer").removeClass("hidden");if(n==null)n=[0];r.on("click",function(){var e=r.index(this),a=false;for(var t=0;t<n.length;t++){if(e==n[t]){a=true;break}}if(a){i.find(".modal-footer").removeClass("hidden")}else{i.find(".modal-footer:not(.hidden)").addClass("hidden")}});i.find("table[data-page-size]").each(function(){f($(this),e,a)})}function f(i,n,r){if(!i||i.length<1)return;var l=i.data(),a=null;if(r){if(l.ajaxList&&l.ajaxList in r)r[l.ajaxList](i);if("switchPage"in r)a=r["switchPage"];if("pageData"in r)l=typeof r["pageData"]=="function"?r["pageData"](i):r["pageData"]}App.withPagination(l,null);i.after(l.pagination);if(!a){a=function(e){var a={ajaxList:l.ajaxList,page:e};a=$.extend(a,n||{});var t=typeof l["pageUrl"]!="undefined"?l["pageUrl"]:window.location.href;$.get(t,a,function(e){var a=i.parent();a.html(e);f(a.children("table[data-page-size]"),n,r)},"html")}}var e=i.next("ul.pagination");e.find("li > a[page]").on("click",function(){if($(this).closest("li.disabled").length>0)return;a($(this).attr("page"))});e.on("refresh",function(){var e=1;if($(this).data("page")){e=$(this).data("page");$(this).data("page",false)}else{e=$(this).find("li.active > a[page]").data("page")||1}a(e)})}function L(e,a){e=e.substring((a+"[").length);return e.substring(0,e.length-1)}function C(e,a){if(e.length<1)return;var t=e.attr("type");switch(e[0].tagName.toLowerCase()){case"input":if(t==="checkbox"){e.prop("checked",false);e.filter('[value="'+a+'"]').prop("checked",true)}else if(t==="radio"){e.filter('[value="'+a+'"]').prop("checked",true)}else{e.val(a)}break;case"select":e.find('option[value="'+a+'"]').prop("selected",true);break;default:e.val(a);break}}function a(e){if(e.length<1)return;var a=e.attr("type");switch(e[0].tagName.toLowerCase()){case"input":if(a==="checkbox"){if(e.attr("name").endsWith("[]")){var t=[];e.filter(":checked").each(function(){t.push($(this).val())});return t}return e.filter(":checked:last").val()}else if(a==="radio"){return e.filter(":checked").val()}return e.val();case"select":return e.val();default:return e.val()}}function t(f,u,o,e,s,d){if(typeof o=="object"&&o!==null){var a=o;var o=null;if("fields"in a)o=a.fields;if("afterOpenCallback"in a)e=a.afterOpenCallback;if("onSubmitCallback"in a)s=a.onSubmitCallback;if("multilingualFieldPrefix"in a)d=a.multilingualFieldPrefix}var t=f.data("modal-title"),i=f.data("form-data"),r=u.find("form");var n=u.find(".modal-header h3"),l=n.data("original-title");if(t){if(!l)n.data("original-title",n.html());n.html(t)}else if(l){n.html(l);n.data("original-title",null)}r[0].reset();var c=u.find(".langset").length>0,h="";if(c){var v=u.find(".langset > .nav-tabs > li:first");if(!v.hasClass("active")){v.children("a").trigger("click")}h=v.children("a").data("lang")}if(i){for(var p in i){var g=i[p],m=r.find('[name="'+p+'"]');C(m,g)}}var k;if(o&&o.length>0){k=function(){return o}}else if(c){if(!d)d="Language";k=function(){var t=d+"["+h+"]";var i=[],n={};r.find("[name]").each(function(){var e=$(this).attr("name");var a=e;if(e.startsWith(d+"[")){if(e.startsWith(t)){a=L(e,t)}else{return}}if(n[a])return;n[a]=true;i.push(a)});return i}}else{k=function(){var a=[],t={};r.find("[name]").each(function(){var e=$(this).attr("name");if(t[e])return;t[e]=true;a.push(e)});return a}}if(e){var b;if(c&&h){b=function(e){var a="Language["+h+"]["+e+"]";if(r.find('[name="'+a+'"]').length>0)return a;return e}}else{b=function(e){return e}}var y=e(f,u,{formData:i,multilingual:c,langDefault:h,getModalFieldName:b,getFields:k});if(y){var o=k();for(var w in o){var g=y(o[w]);if(g===undefined||g===null)continue;r.find('[name="'+b(o[w])+'"]').val(g)}}}var x=u.find(".modal-footer .btn-primary");x.off("click").on("click",function(){var e=u.find("form"),t={};e.find("[name]").each(function(){var e=$(this).attr("name");if(!e)return;switch(this.tagName.toLowerCase()){case"input":switch(this.type){case"checkbox":if(!this.checked)return;if(e.endsWith("[]")){if(!t[e])t[e]=[];t[e].push($(this).val())}else{t[e]=$(this).val()}return;case"radio":if(!this.checked)return;t[e]=$(this).val();return;case"button":return;default:t[e]=$(this).val()}break;default:t[e]=$(this).val();break}});var i={data:t,multilingual:c};if(c){if(!d)d="Language";if(!o){var n=d+"["+h+"]";e.find("[name]").each(function(){var e=$(this).attr("name");var a=e;if(e.startsWith(d+"[")){if(e.startsWith(n)){a=L(e,n)}else{return}}i[a]=t[e]})}else{for(var a=0;a<o.length;a++){var r=o[a];i[r]=t[d+"["+h+"]["+r+"]"]}}i.langDefault=h}else{if(!o){for(var l in t){i[l]=t[l]}}else{for(var a=0;a<o.length;a++){var r=o[a];i[r]=t[r]}}}if(s)s(f,u,i)})}function i(e,a,t,i,n){var r="Language[",l="",f="";if(t){for(var u=0;u<t.length;u++){l+="["+t[u]+"]";if(u==0){f+=t[u]}else{f+="["+t[u]+"]"}}}for(var o in a.data){if(!o.startsWith(r))continue;var s=o.substring(r.length);s=s.substring(0,s.length-1);var d=s.split("][");if(d.length!=2)continue;if(d[0]==a.langDefault)continue;if(i)d[1]=i(d[1]);var c="Language"+l+"["+d[0]+"]["+d[1]+"]",h=e.find('input[type=hidden][name="'+c+'"]');if(h.length>0){h.val(a.data[o]);continue}e.prepend('<input type="hidden" name="'+c+'" value="'+a.data[o]+'" />')}var v;if(f){v=function(e){return f+"["+e+"]"}}else{v=function(e){return e}}var c=v("translate"),h=e.find('input[type=hidden][name="'+c+'"]'),p="forceTranslate"in a.data?a.data.forceTranslate:"";if(h.length>0){h.val(p)}else{e.prepend('<input type="hidden" name="'+c+'" value="'+p+'" />')}if(n){for(var o in a){if(o=="data"||o=="langDefault"||o=="multilingual")continue;if(i)o=i(o);var g=n.find('[name="'+v(o)+'"]');if(g.length==0)continue;var m=g.attr("type");switch(m){case"radio":g.filter('[value="'+a[o]+'"]').prop("checked",true);break;case"checkbox":g.prop("checked",false);if(typeof a[o]=="array"){for(var u=0;u<a[o].length;u++){g.filter('[value="'+a[o][u]+'"]').prop("checked",true)}}else{g.filter('[value="'+a[o]+'"]').prop("checked",true)}break;default:if(g[0].tagName.toLowerCase()=="select"){g.find('option[value="'+a[o]+'"]').prop("selected",true)}else{g.val(a[o])}break}}}}App.initModalBody=e;App.initModalBodyPagination=f;App.initModalForm=t;App.updateMultilingualFormByModal=i;App.getFormFieldValue=a;App.setFormFieldValue=C})();