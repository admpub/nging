(function(){function a(n,a,e,t){var r=n.find(".modal-body .nav-tabs>li");n.find(".modal-footer").removeClass("hidden");if(t==null)t=[0];r.on("click",function(){var a=r.index(this),e=false;for(var i=0;i<t.length;i++){if(a==t[i]){e=true;break}}if(e){n.find(".modal-footer").removeClass("hidden")}else{n.find(".modal-footer:not(.hidden)").addClass("hidden")}});n.find("table[data-page-size]").each(function(){f($(this),a,e)})}function f(n,t,r){if(!n||n.length<1)return;var l=n.data(),e=null;if(r){if(l.ajaxList&&l.ajaxList in r)r[l.ajaxList](n);if("switchPage"in r)e=r["switchPage"];if("pageData"in r)l=typeof r["pageData"]=="function"?r["pageData"](n):r["pageData"]}App.withPagination(l,null);n.after(l.pagination);if(!e){e=function(a){var e={ajaxList:l.ajaxList,page:a};e=$.extend(e,t||{});var i=typeof l["pageUrl"]!="undefined"?l["pageUrl"]:window.location.href;$.get(i,e,function(a){var e=n.parent();e.html(a);f(e.children("table[data-page-size]"),t,r)},"html")}}var a=n.next("ul.pagination");a.find("li > a[page]").on("click",function(){if($(this).closest("li.disabled").length>0)return;e($(this).attr("page"))});a.on("refresh",function(){var a=1;if($(this).data("page")){a=$(this).data("page");$(this).data("page",false)}else{a=$(this).find("li.active > a[page]").data("page")||1}e(a)})}function C(a,e){a=a.substring((e+"[").length);return a.substring(0,a.length-1)}function F(a,e){if(a.length<1)return;switch(a[0].tagName.toLowerCase()){case"input":var i=a.attr("type");if(i==="checkbox"){a.prop("checked",false);if(e===undefined||e===null)return;a.filter('[value="'+e+'"]').prop("checked",true)}else if(i==="radio"){if(e===undefined||e===null)return;a.filter('[value="'+e+'"]').prop("checked",true)}else{if(e===undefined||e===null)return;a.val(e)}break;case"select":if(e===undefined||e===null)return;a.find('option[value="'+e+'"]').prop("selected",true);break;default:if(e===undefined||e===null)return;a.val(e);break}}function w(a){if(a.length<1)return null;var e=a.attr("type");switch(a[0].tagName.toLowerCase()){case"input":if(e==="checkbox"){if(a.attr("name").endsWith("[]")){var i=[];a.filter(":checked").each(function(){i.push($(this).val())});return i}return a.filter(":checked:last").val()}else if(e==="radio"){return a.filter(":checked").val()}return a.val();case"select":return a.val();default:return a.val()}}function e(u,d,o,a,s,c){if(typeof o=="object"&&o!==null){var e=o;var o=null;if("fields"in e)o=e.fields;if("afterOpenCallback"in e)a=e.afterOpenCallback;if("onSubmitCallback"in e)s=e.onSubmitCallback;if("multilingualFieldPrefix"in e)c=e.multilingualFieldPrefix}var i=u.data("modal-title"),n=u.data("form-data"),r=d.find("form");var t=d.find(".modal-header h3"),l=t.data("original-title");if(i){if(!l)t.data("original-title",t.html());t.html(i)}else if(l){t.html(l);t.data("original-title",null)}r[0].reset();var g=d.find(".langset").length>0,h="";if(g){var f=d.find(".langset > .nav-tabs > li:first");if(!f.hasClass("active")){f.children("a").trigger("click")}h=f.children("a").data("lang")}if(n){for(var v in n){F(r.find('[name="'+v+'"]'),n[v])}}var p;if(o&&o.length>0){p=function(){return o}}else if(g){if(!c)c="Language";p=function(){var i=c+"["+h+"]";var n=[],t={};r.find("[name]").each(function(){var a=$(this).attr("name");var e=a;if(a.startsWith(c+"[")){if(a.startsWith(i)){e=C(a,i)}else{return}}if(t[e])return;t[e]=true;n.push(e)});return n}}else{p=function(){var e=[],i={};r.find("[name]").each(function(){var a=$(this).attr("name");if(i[a])return;i[a]=true;e.push(a)});return e}}if(a){var m;if(g&&h){m=function(a){var e="Language["+h+"]["+a+"]";if(r.find('[name="'+e+'"]').length>0)return e;return a}}else{m=function(a){return a}}var b=a(u,d,{formData:n,multilingual:g,langDefault:h,getModalFieldName:m,getFields:p});if(b){var o=p();for(var k in o){var y=b(o[k]);if(y&&typeof y=="object")y=w(y);if(y===undefined||y===null)continue;var x=r.find('[name="'+m(o[k])+'"]');F(x,y);x.trigger("change")}}}var L=d.find(".modal-footer .btn-primary");L.off("click").on("click",function(){var e=d.find("form"),i={};e.find("[name]").each(function(){var a=$(this).attr("name");if(!a)return;if(a in i)return;i[a]=w(e.find('[name="'+a+'"]'))});var a={data:i,multilingual:g};if(g){if(!c)c="Language";if(!o){var n=c+"["+h+"]";for(var t in i){var r=t;if(t.startsWith(c+"[")){if(t.startsWith(n)){r=C(t,n)}else{return}}a[r]=i[t]}}else{for(var l=0;l<o.length;l++){var r=o[l];var f=c+"["+h+"]["+r+"]";if(f in i){a[r]=i[f]}else{a[r]=i[r]}}}a.langDefault=h}else{if(!o){for(var t in i){a[t]=i[t]}}else{for(var l=0;l<o.length;l++){var r=o[l];a[r]=i[r]}}}if(s)s(u,d,a)})}function i(a,e,i,n,t,r){var l="Language[",f="",u="";if(i){for(var d=0;d<i.length;d++){f+="["+i[d]+"]";if(d==0){u+=i[d]}else{u+="["+i[d]+"]"}}}for(var o in e.data){if(!o.startsWith(l))continue;var s=o.substring(l.length);s=s.substring(0,s.length-1);var c=s.split("][");if(c.length!=2)continue;if(c[0]==e.langDefault)continue;if(n)c[1]=n(c[1]);var g="Language"+f+"["+c[0]+"]["+c[1]+"]",h=a.find('input[type=hidden][name="'+g+'"]');if(h.length<1){h=$('<input type="hidden" name="'+g+'" value="'+e.data[o]+'" />');a.prepend(h)}h.val(e.data[o]);if(r)r(h,c[1],e.data[o])}var v;if(u){v=function(a){return u+"["+a+"]"}}else{v=function(a){return a}}var g=v("translate"),h=a.find('input[type=hidden][name="'+g+'"]'),p="forceTranslate"in e.data?e.data.forceTranslate:"";if(h.length<1){h=$('<input type="hidden" name="'+g+'" value="'+p+'" />');a.prepend(h)}h.val(p);if(r)r(h,"translate",p);if(t){for(var o in e){if(o=="data"||o=="langDefault"||o=="multilingual"||o=="forceTranslate")continue;var p=e[o];if(n)o=n(o);var m=t.find('[name="'+v(o)+'"]');F(m,p);if(m.length>0&&r)r(m,o,p)}}}App.initModalBody=a;App.initModalBodyPagination=f;App.initModalForm=e;App.updateMultilingualFormByModal=i;App.getFormFieldValue=w;App.setFormFieldValue=F})();