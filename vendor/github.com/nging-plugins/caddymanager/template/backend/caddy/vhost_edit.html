{{Extend "layout"}}
{{Block "title"}}{{$.Stored.title}}{{/Block}}
{{Block "breadcrumb"}}
{{Super}}
<li class="active">{{$.Stored.title}}</li>
{{/Block}}
{{Block "headEnd"}}
<style type="text/css">
.extra-page-remove{position:absolute;display:none;border-radius:0 0 50px 0;z-index:2;}
.fieldset:hover .extra-page-remove{display:block;}
</style>
{{/Block}}
{{Block "main"}}
<div class="row">
    <div class="col-md-12">
        <div class="block-flat">
          <div class="header">							
            <h3>{{$.Stored.title}}</h3>
          </div>
          <div class="content">
              <form class="form-horizontal group-border-dashed" method="POST" action="" id="vhostForm">
              <div class="form-group">
                  <label class="col-sm-2 control-label">{{"分组"|$.T}}</label>
                  <div class="col-sm-3">
                      {{$v := $.Form "groupId"}}
                      <select class="form-control" name="groupId">
                          <option value="">{{"<无>"|$.T}}</option>
                          {{range $k,$g:=$.Stored.Get "groupList"}}
                          <option value="{{$g.Id}}"{{if eq $v (Str $g.Id)}} selected{{end}}>{{$g.Name}}</option>
                          {{end}}
                      </select>
                  </div>
                  <label class="col-sm-2 control-label">{{"引擎配置"|$.T}}</label>
                  <div class="col-sm-3">{{$v := $.Form "serverIdent"}}
                      <select class="form-control" id="serverIdent" name="serverIdent">
                          <option value="default" data-engine="default" data-environ="local">{{"<默认>"|$.T}}</option>
                          {{range $k,$g:=$.Stored.Get "serverList"}}
                          <option value="{{$g.Ident}}" data-engine="{{$g.Engine}}" data-environ="{{$g.Environ}}"{{if eq $v $g.Ident}} selected{{end}}>{{$g.Name}}</option>
                          {{end}}
                      </select>
                  </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"监听地址"|$.T}}</label>
                <div class="col-sm-8">
                    <input type="text" id="bind-address" name="domain" class="form-control" required="required" value="{{$.Form "domain"}}">
                    <div class="help-block">
                      {{"可以是网址、域名或IP。如果不提供端口则默认为2005，如果不提供协议(比如https://)则默认为http，如果不提供IP和域名则默认为0.0.0.0，如果只想允许本机访问请设置为localhost或127.0.0.1。"|$.T}}<br />
                      {{"域名支持通配符“*”(例如*.admpub.com)和环境变量(环境变量用花括号括起来，例如localhost:{$PORT})。"|$.T}}<br />
                      {{"例子"|$.T}}: 
                      <span class="badge badge-success clickable" onclick="App.insertAtCursor($('#bind-address')[0],$(this).text(),8,18);">https://admpub.com:443</span>
                      <span class="badge badge-primary clickable" onclick="App.insertAtCursor($('#bind-address')[0],$(this).text(),0,10);">admpub.com:80</span>
                      <span class="badge badge-danger clickable" onclick="App.insertAtCursor($('#bind-address')[0],$(this).text(),1,6);">:8080</span>
                      <span class="badge badge-info clickable" onclick="App.insertAtCursor($('#bind-address')[0],$(this).text(),10,14);">127.0.0.1:9999</span><br />
                      {{"监听地址如有多个，用空格隔开。"|$.T}}
                    </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"网站位置"|$.T}}</label>
                <div class="col-sm-8">
                    <input type="text" id="www-root-path" name="root" class="form-control typeahead" value="{{$.Form "root"}}" data-provide="typeahead">
                    <div class="help-block">{{"网站文件夹在服务器上的绝对路径"|$.T}}</div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"网站名称"|$.T}}</label>
                <div class="col-sm-8">
                    <input type="text" name="name" class="form-control" value="{{$.Form "name"}}">
                    <div class="help-block">
                      {{"为了提高辨识度，您可以给网站起一个名字。"|$.T}}
                    </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"默认首页"|$.T}}</label>
                <div class="col-sm-8">
                    <input type="text" name="index" class="form-control" value="{{$.Form "index"}}">
                    <div class="help-block">{{"默认首页文件，多个之间用半角空格隔开，如不填写，默认为："|$.T}}<br/> 
                      index.html index.htm index.txt default.html default.htm default.txt
                    </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"访问日志"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "log" "1"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="log-enable" name="log" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="log-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="log-disable" name="log" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="log-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="log-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/log"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"响应Header"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/header" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  <div class="fieldset bg-fc">
                    <div class="form-group">
                          <label class="col-sm-2 control-label">{{"指定路径"|$.T}}</label>
                          <div class="col-sm-9">
                             <input type="text" class="form-control" name="header_path" value="{{$.Form "header_path"}}">
                             <div class="help-block">{{"可以针对某个起始路径设置header"|$.T}}</div>
                          </div>
                    </div>

                    <div class="form-group">
                          <label class="col-sm-2 control-label">{{"设置Header"|$.T}}</label>
                          <div class="col-sm-9">
                    <table>
								        <thead>
								        	<tr>
								        		<th style="width:50%;">{{"字段名"|$.T}}</th>
								        		<th>{{"值"|$.T}}</th>
								        		<th width="70">{{"删除"|$.T}}</th>
								        	</tr>
								        </thead>
								        <tbody>
                                {{$vals := $.FormValues "header_v"}}
                                {{$vlen := len $vals}}
                                {{range $k,$v:=$.FormValues "header_k"}}
                                    {{if lt $k $vlen}}
<tr>
	<td><input type="text" class="form-control" name="header_k" value="{{$v}}"></td>
	<td><input type="text" class="form-control" name="header_v" value="{{index $vals $k}}"></td>
	<td class="text-center">
    <button type="button" class="btn btn-danger" onclick="$(this).parent().parent().remove()">
      <i class="fa fa-times"></i>
    </button>
  </td>
</tr>
                                        
                                    {{end}}
                                {{end}}
								        	<tr>
								        		<td colspan="3" class="text-center primary-emphasis" style="cursor:pointer" id="headerAddVarBtn" onclick="addKVs(this,'header_k','header_v');"><i class="fa fa-plus"></i></td>
								        	</tr>
								        </tbody>
							      </table>
                    <div class="help-block">
                      {{"如果要将已存在的header删掉，请在名称前使用减号(-)并将其值留空"|$.T}}
                      ({{`Nginx不支持删除响应header`|$.T}})
                    </div>
                  </div>
                  
                          </div>
                    </div>

                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"HTTPS"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/tls" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-caddy2" href="https://caddyserver.com/docs/caddyfile/directives/tls" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-nginx" href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                    {{$v := $.Form "tls"}}
                    <div class="radio radio-primary radio-inline"> 
                      <input type="radio" value="1" id="tls-enable" name="tls" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="tls-enable">{{"启用"|$.T}}</label> 
                    </div>
                    <div class="radio radio-danger radio-inline"> 
                      <input type="radio" value="0" id="tls-disable" name="tls" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="tls-disable">{{"禁用"|$.T}}</label> 
                    </div>
                    <div class="fieldset bg-fc hide" id="tls-settings">
                        {{if eq $v "1"}}{{Include "caddy/addon/form/tls"}}{{end}}
                    </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"GZIP"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/gzip" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-caddy2" href="https://caddyserver.com/docs/caddyfile/directives/encode" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-nginx" href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html#gzip" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "gzip"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="gzip-enable" name="gzip" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="gzip-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="gzip-disable" name="gzip" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="gzip-disable">{{"禁用"|$.T}}</label> 
                  </div>
                    <div class="fieldset bg-fc hide" id="gzip-settings">
                        {{if eq $v "1"}}{{Include "caddy/addon/form/gzip"}}{{end}}
                    </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"FastCGI"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/fastcgi" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-caddy2" href="https://caddyserver.com/docs/caddyfile/directives/php_fastcgi#syntax" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-nginx" href="https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_pass" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "fastcgi"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="fastcgi-enable" name="fastcgi" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="fastcgi-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="fastcgi-disable" name="fastcgi" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="fastcgi-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="fastcgi-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/fastcgi"}}{{end}}
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"Proxy"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/proxy" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-caddy2" href="https://caddyserver.com/docs/caddyfile/directives/reverse_proxy#syntax" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-nginx" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "proxy"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="proxy-enable" name="proxy" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="proxy-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="proxy-disable" name="proxy" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="proxy-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="proxy-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/proxy"}}{{end}}
                  </div>
                </div>
              </div>

              
              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"文件服务"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/browse" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-caddy2" href="https://caddyserver.com/docs/caddyfile/directives/file_server#syntax" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                  <a class="engine-show-nginx" href="https://nginx.org/en/docs/http/ngx_http_autoindex_module.html" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "browse"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="browse-enable" name="browse" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="browse-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="browse-disable" name="browse" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="browse-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="browse-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/browse"}}{{end}}
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label">
                  {{"静态文件缓存"|$.T}}
                  <a class="engine-show-default" href="https://caddyserver.com/docs/http.expires" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "expires"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="expires-enable" name="expires" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="expires-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="expires-disable" name="expires" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="expires-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="expires-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/expires"}}{{end}}
                  </div>
                </div>
              </div>
              
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">
                  {{"IP过滤"|$.T}}
                  <a href="https://caddyserver.com/docs/http.ipfilter" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "ipfilter"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="ipfilter-enable" name="ipfilter" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="ipfilter-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="ipfilter-disable" name="ipfilter" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="ipfilter-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="ipfilter-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/ipfilter"}}{{end}}
                  </div>
                </div>
              </div>

              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">
                  {{"响应内容过滤"|$.T}}
                  <a href="https://caddyserver.com/docs/http.filter" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
                </label>
                <div class="col-sm-8">
                  {{$v := $.Form "filter"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="filter-enable" name="filter" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="filter-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="filter-disable" name="filter" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="filter-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="hide" id="filter-settings">
                    <div class="fieldset bg-fc spacer-bottom-xs">
                    <div class="form-group">
                      <label class="col-sm-3 control-label">{{`内容尺寸上限`}}</label>
                      <div class="col-sm-9">
                        <span class="input-group">
                         <input class="form-control" type="number" id="filter_max_buffer_size" name="filter_max_buffer_size" value="{{$.Form `filter_max_buffer_size`}}" min="0">
                         <span class="input-group-addon">{{`字节`|$.T}}</span>
                        </span>
                         <div class="help-block">{{"超过此尺寸的内容不会替换，默认为: 10485760 (=10 MB)"|$.T}}</div>
                      </div>
                    </div>
                    </div><!-- /.fieldset -->
                    <div id="filter-settings-inner">
                    {{- range $index, $value := $.FormxValues `filter_search_pattern` -}}
                    {{- $.Set `filterIndex` $index -}}
                    {{Include "caddy/addon/form/filter" $}}
                    {{- else -}}
                    {{- $.Set `filterIndex` 0 -}}
                    {{Include "caddy/addon/form/filter" $}}
                    {{- end -}}
                    </div>
                    <a href="javascript:;" onclick="copyFormHTML('#filter-settings-inner')" class="label label-primary text-white wd-100p" style="display:block"><i class="fa fa-plus"></i></a>
                  </div>
                </div>
              </div>
<div class="form-group">
  <label class="col-sm-2 control-label">
    {{"网址重写"|$.T}}
    <a class="engine-show-default" href="https://caddyserver.com/docs/rewrite" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
    <a class="engine-show-caddy2" href="https://caddyserver.com/docs/caddyfile/directives/rewrite" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
    <a class="engine-show-nginx" href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite" target="_blank" data-toggle="tooltip" title="{{`查看文档`|$.T}}" class="normal">(?)</a>
  </label>
  <div class="col-sm-8">
    <textarea type="text" id="rewrite_rule" class="form-control" style="min-height:200px" name="rewrite_rule">{{$.Form "rewrite_rule"}}</textarea>
    <div class="help-block">
      <div class="engine-show-default">{{Include "caddy/addon/help_rewrite"}}</div><!-- /.engine-show-default -->
      <div class="engine-show-caddy2">
        {{`语法：`|$.T}} <strong>rewrite</strong> <em>[&lt;matcher&gt;]</em> <em>&lt;to&gt;</em><br />
        {{`例如：`|$.T}}  
        <pre>rewrite * /foo.html
rewrite /api/* ?a=b
rewrite /api/* ?{query}&a=b
rewrite * /index.php?{query}&p={path}</pre>
      </div><!-- /.engine-show-caddy2 -->
      <div class="engine-show-nginx">
        {{`语法：`|$.T}} <strong>rewrite</strong> <em>regex</em> <em>replacement</em> <em>[flag]</em>;<br />
        {{`例如：`|$.T}} 
        <pre>rewrite ^(/download/.*)/media/(.*)\..*$ $1/mp3/$2.mp3 last;
rewrite ^(/download/.*)/audio/(.*)\..*$ $1/mp3/$2.ra  last;</pre>
      </div><!-- /.engine-show-nginx -->
    </div><!-- /.help-block -->
  </div> 
</div>

              <div class="form-group">
                <label class="col-sm-2 control-label">{{"BasicAuth"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "basicauth"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="basicauth-enable" name="basicauth" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="basicauth-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="basicauth-disable" name="basicauth" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="basicauth-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="basicauth-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/basicauth"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"限流"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "ratelimit"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="ratelimit-enable" name="ratelimit" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="ratelimit-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="ratelimit-disable" name="ratelimit" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="ratelimit-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="ratelimit-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/ratelimit"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"跨域支持(CORS)"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "cors"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="cors-enable" name="cors" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="cors-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="cors-disable" name="cors" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="cors-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="cors-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/cors"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"JWT"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "jwt"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="jwt-enable" name="jwt" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="jwt-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="jwt-disable" name="jwt" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="jwt-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="jwt-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/jwt"}}{{end}}
                  </div>
                  <div class="help-block">JSON Web Token</div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"多语言"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "locale"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="locale-enable" name="locale" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="locale-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="locale-disable" name="locale" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="locale-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="locale-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/locale"}}{{end}}
                  </div>
                  <div class="help-block">{{"获取当前语言类型并设置到占位符{>Detected-Locale}中"|$.T}}</div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"反爬虫"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "nobots"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="nobots-enable" name="nobots" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="nobots-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="nobots-disable" name="nobots" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="nobots-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="nobots-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/nobots"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"Prometheus"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "prometheus"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="prometheus-enable" name="prometheus" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="prometheus-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="prometheus-disable" name="prometheus" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="prometheus-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="prometheus-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/prometheus"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"S3Browser"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "s3browser"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="s3browser-enable" name="s3browser" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="s3browser-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="s3browser-disable" name="s3browser" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="s3browser-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="s3browser-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/s3browser"}}{{end}}
                  </div>
                  <div class="help-block">{{"浏览 Amazon S3(或其它与S3兼容的对象存储引擎) 对象目录"|$.T}}</div>
                </div>
              </div>
              <div class="engine-show-default form-group">
                <label class="col-sm-2 control-label">{{"WebDAV"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "webdav"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="1" id="webdav-enable" name="webdav" data-slide-settings="show"{{if eq $v "1"}} checked{{end}}><label for="webdav-enable">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="0" id="webdav-disable" name="webdav" data-slide-settings="hide"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="webdav-disable">{{"禁用"|$.T}}</label> 
                  </div>
                  <div class="fieldset bg-fc hide" id="webdav-settings">
                    {{if eq $v "1"}}{{Include "caddy/addon/form/webdav"}}{{end}}
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"备注"|$.T}}</label>
                <div class="col-sm-8">
                  <textarea class="form-control" name="remark">{{$.Form "remark"}}</textarea>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"网站状态"|$.T}}</label>
                <div class="col-sm-8">
                  {{$v := $.Form "disabled"}}
                  <div class="radio radio-primary radio-inline"> 
                    <input type="radio" value="N" id="disabled-N" name="disabled"{{if or (eq $v "N") (eq $v "")}} checked{{end}}><label for="disabled-N">{{"启用"|$.T}}</label> 
                  </div>
                  <div class="radio radio-danger radio-inline"> 
                    <input type="radio" value="Y" id="disabled-Y" name="disabled"{{if eq $v "Y"}} checked{{end}}><label for="disabled-Y">{{"禁用"|$.T}}</label> 
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">{{"附加操作"|$.T}}</label>
                <div class="col-sm-8">
                  <div class="checkbox checkbox-success checkbox-inline"> 
                    <input type="checkbox" value="1" id="restart-enable" name="restart" checked="checked"><label for="restart-enable" class="text-left">{{"重启服务"|$.T}}</label>
                  </div>
                  <div class="checkbox checkbox-warning checkbox-inline"> 
                    <input type="checkbox" value="1" id="removeCachedCert" name="removeCachedCert"><label for="removeCachedCert" class="text-left">{{"删除HTTPS证书缓存"|$.T}}</label> 
                  </div>
                </div>
              </div>

              <div class="form-group form-submit-group">
                <div class="col-sm-2 control-label">&nbsp;</div>
									<div class="col-sm-9">
									  <button type="submit" class="btn btn-primary btn-lg"><i class="fa fa-save"></i> {{"保存"|$.T}}</button>
                    <button type="reset" class="btn btn-default btn-lg"><i class="fa fa-refresh"></i> {{"重置"|$.T}}</button>
									</div>
							</div>
            </form>
          </div><!-- /.content -->
        </div><!-- /.block-flat -->
    </div>
</div>
{{/Block}}
{{Block "footer"}}
<script type="text/javascript" src="{{AssetsURL}}/js/textarea/editor.min.js"></script>
<script type="text/template" id="tmplAddVariableRow">
<tr>
	<td><input type="text" class="form-control" name="{k}" value=""></td>
	<td><input type="text" class="form-control" name="{v}" value=""></td>
	<td class="text-center">
    <button type="button" class="btn btn-danger" onclick="$(this).parent().parent().remove()">
      <i class="fa fa-times"></i>
    </button>
  </td>
</tr>
</script>
<script type="text/template" id="tmplAddVariableRowSingleCell">
<tr>
	<td><input type="text" class="form-control" name="{k}" value=""></td>
	<td class="text-center">
    <button type="button" class="btn btn-danger" onclick="$(this).parent().parent().remove()">
      <i class="fa fa-times"></i>
    </button>
  </td>
</tr>
</script>
{{call $.Func.Modal "__TMPL__/caddy/request_placeholders.yaml"}}
<script>
var inputRequestPlaceholder=null;
function showRequestPlaceholders(a){
  if(a==null) a='#rewrite_rule';
  inputRequestPlaceholder=a;
  $('#request-placeholders-modal').niftyModal('show');
}
function insertAdvRewrite(){
  App.insertAtCursor($('#rewrite_rule')[0],'rewrite / {\n\
    regexp pattern\n\
    ext    extensions...\n\
    if     a cond b\n\
    if_op  [and|or]\n\
    to     destinations...\n\
}\n',23,31);
}
function insertAdvRedir(){
  App.insertAtCursor($('#rewrite_rule')[0],'redir 301 {\n\
    if {>X-Forwarded-Proto} is http\n\
    /  https://{host}{uri}\n\
}\n');
}
function insertCondForRewrite(obj){
  App.insertAtCursor($('#rewrite_rule')[0],$(obj).children('strong').text()+' ');
}
function addKVs(obj,k,v){
  var tmpl=$('#tmplAddVariableRow').html();
  tmpl=tmpl.replace(/\{k\}/g,k);
  tmpl=tmpl.replace(/\{v\}/g,v);
  $(obj).parent().before(tmpl);
}
function addKs(obj,k,v){
  var tmpl=$('#tmplAddVariableRowSingleCell').html();
  tmpl=tmpl.replace(/\{k\}/g,k);
  $(obj).parent().before(tmpl);
}
function initReqPlaceholdersModal(){
  $('#request-placeholders-modal').find('.modal-body').css({"max-height":$(window).height()-200});
}
function copyFormHTML(boxElem){
  var base = $(boxElem).children('.fieldset:first');
  var copied = base.clone();
  copied.prepend('<a href="javascript:;" class="label label-danger extra-page-remove" onclick="removeFormHTML(this);" data-toggle="tooltip" title="{{`删除`|$.T}}"><i class="fa fa-times"></i></a>');
  copied.find('input[type="text"]').val('');
  copied.find('textarea').text('');
  if(base.next('.fieldset').length>0){
    base.siblings('.fieldset:last').after(copied);
  }else{
    base.after(copied);
  }
}
function removeFormHTML(obj){
  $(obj).parent('.fieldset').remove();
}
$(function(){
initReqPlaceholdersModal();
$(window).on('resize',function(){
  initReqPlaceholdersModal();
});
$('#vhostForm [data-slide-settings]').each(function(){
  var eid='#'+$(this).attr('name')+'-settings';
  if($(eid).data('history'))$(eid).data('history',null);
});
var requiredWWWRootPathFields=['fastcgi','browse'];//必须设置“网站位置”的模块
$('#vhostForm [data-slide-settings]').on('click',function(){
  var slide=$(this).data('slide-settings'),name=$(this).attr('name');
  if(slide=="")slide=$(this).val()=='1'?'show':'hide';
  var eid='#'+name+'-settings',innerid='#'+name+'-settings-inner';
  if($(innerid).length<1) innerid=eid;
  var history=$.trim($(innerid).html());
  for(var i=0;i<requiredWWWRootPathFields.length;i++){
    if(name==requiredWWWRootPathFields[i]){
      if(slide=='show'){
        $('#www-root-path').prop('required',true);
      }else{
        var checked=false;
        for(var j=0;j<requiredWWWRootPathFields.length;j++){
          var f=requiredWWWRootPathFields[j];
          if($('#'+f+'-enable').prop('checked')){
            checked=true;
            break;
          }
        }
        $('#www-root-path').prop('required',checked);
      }
      break;
    }
  }
  if(slide=='show'){
    if(!history){
      if($(innerid).data('history')){
        $(innerid).html($(innerid).data('history'));
      }else{
        $.get(BACKEND_URL+'/caddy/addon_form',{addon:name},function(r){
          $(innerid).html(r);
        },'html');
      }
    }
    $(eid).removeClass('hide');
  }else{
    if(history)$(innerid).data('history',history);
    $(innerid).empty();
    $(eid).addClass('hide');
  }
});
$('#vhostForm [data-slide-settings="show"]:checked').trigger('click');
$('#request-placeholders-modal .modal-body table tbody td b').off().on('click',function(){
  App.insertAtCursor($(inputRequestPlaceholder)[0],$(this).text());
  $('#request-placeholders-modal').niftyModal('hide');
});
$('[data-popover="popover"]').on('click',function(){
  $(this).siblings('[data-popover="popover"]').popover('hide');
});
$('#serverIdent').on('change',function(){
  var engine=$(this).children('option:selected').data('engine'), $form=$('#vhostForm');
  $form.find('.engine-show-'+engine).show();
  $form.find('.engine-hide-'+engine).hide();
  $form.find('[class^="engine-hide"]:not(.engine-hide-'+engine+')').show();
  $form.find('[class^="engine-show"]:not(.engine-show-'+engine+')').hide();
}).trigger('change');
App.searchFS('#www-root-path',20,'dir');
});
</script>
{{/Block}}